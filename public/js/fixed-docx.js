/**
 * Fixed wrapper for docx library to avoid "sections is not iterable" error
 */
(function() {
    // Load the docx v7.8.0 library
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/docx@7.8.0/build/index.js';
    script.async = false;
    
    script.onload = function() {
        console.log('docx v7.8.0 loaded successfully');
        
        // Create a fixed version of the library
        if (typeof docx !== 'undefined') {
            // Store original constructors
            const originalFile = docx.File;
            const originalDocument = docx.Document;
            
            // Override Document constructor to provide defaults
            docx.Document = function(options) {
                // Ensure options has all required properties
                options = options || {};
                
                // Add default properties if missing
                options.creator = options.creator || "AI Document Generator";
                options.title = options.title || "Generated Document";
                options.description = options.description || "Document generated by AI";
                options.sections = options.sections || [];
                
                // Apply original constructor
                return new originalDocument(options);
            };
            
            // Override File constructor to fix sections issue
            docx.File = function(options) {
                // Ensure options has the required structure
                options = options || {};
                
                // Fix potential issues
                if (!options.creator) options.creator = "AI Document Generator";
                if (!options.sections || !Array.isArray(options.sections)) {
                    options.sections = [];
                }
                
                // Call original constructor with fixed options
                return new originalFile(options);
            };
            
            console.log('Applied docx library fixes');
        }
    };
    
    document.head.appendChild(script);
})(); 